[![Electron Logo](https://www.vectorlogo.zone/logos/electronjs/electronjs-icon.svg)](https://electronjs.org/)

[![License](https://img.shields.io/badge/License-AGPL--3-brightgreen.svg)](LICENSE.md)

# Introduction

This is a software architecture lib written in TypeScript, with common electron solutions used by my apps.

Topics:

1. [Installation](#installation)
1. [Functionalities](#functionalities)
   1. [Error Abstraction](#error-abstraction)
   1. [EnvironmentDetector](#environmentdetector)
   1. [MainWindowController](#mainwindowcontroller)

# Installation

Install with: `npm i @alandrade21/electron-arch -S`

It is not necessary to import an @types. This project has all the necessary definitions.

# Functionalities

## Error Abstraction

This lib deliver some classes for error abstraction, facilitating the error type detection.

### ErrorWrapper

This is intended as a super class of all specific error classes used during development. It encapsulates a message (required) and a JS error object (or anything throw during execution) (default null). It also provides a string type field (default null), in the case it would be necessary to provide additional typing info.

To use:

```typescript
import { ErrorWrapper } from '@alandrade21/electron-arch';

export class MyCustomError extends ErrorWrapper {}
```

### InvalidParameterError

This is an [ErrorWrapper](#errorWrapper) generated by a invalid use of a parameter in a method, like a required parameter not informed.

An object of this class has a type with the value `RUN_TIME_ERROR` and a consoleLog() method that prints itself to the console printing `'InvalidParameterError: '` before the message.

To use: `import { InvalidParameterError } from '@alandrade21/electron-arch';`

## EnvironmentDetector

Class to verify if the app is running in development environment. This is made to allow that a "production" version can be used in the same machine used to development, preserving the production database and configuration files.

To the environment be identified as development, the app must be started with the command `ELECTRON_ENV=dev electron .`. The best way to use this is create an script in package.json file.

To use: `import { envDetector } from '@alandrade21/electron-arch';`

To test the environment, use `envDetector.isDev()`. If true, you are in development environment.

To see some environment variables, use `envDetector.printEnvironment()`. This method prints its output to the console.

## MainWindowController

This is an abstraction to the electron main window initialization, created according to https://medium.com/@davembush/typescript-and-electron-the-right-way-141c2e15e4e1.

To use: `import { MainWindowController } from '@alandrade21/electron-arch';`

### Usage

This class have some static utility methods. They must be called only after `app.on('ready')` event.

#### Main window initialization

After `app.on('ready')` event call `MainWindowController.initialize()`. If the main window is already initialized when this static method is called, an `MainWindowAlreadyInitializedError` is throw.

The main window created by this method is not showed automatically. To show the window call `MainWindowController.mainWindow.show()`.

If the app is fired in development environment (see [EnvironmentDetector](#environmentdetector)) with the --serve parameter, the main window will be loaded with the content of `http://localhost:4200`. Else, the main window will be loaded with the file `./dist/index.html`.

If the app is fired in development environment (see [EnvironmentDetector](#environmentdetector)), the dev tools will be opened.

#### Main window access

To access the main window created use `MainWindowController.mainWindow`. This will throw an `MainWindowNotInitializedError` if the main window were not initialized yet.

## ConfigFileManager

## ConfigData

The electron app has its configuration options saved inside a configuration file. Inside the electron app this file is represented by an object that holds all configuration data. This object is a instance of a class that implements the ConfigData interface.

This interface has no contracts and only is used by means of type safety.

## AppConfigurator

This is an abstract super class for local electron app configurator class, with basic configuration functionalities already built.

To use:

```typescript
import { AppConfigurator } from '@alandrade21/electron-arch';

export class InitializationController extends AppConfigurator<ConfigOptions> {}
```

In the above code, the class ConfigOptions is a class that implements the interface [ConfigData](#configdata) and represents the app config options that will be saved to a configuration file.

### Usage

#### Instantiation

This super class has a constructor with the following signature:

```typescript
constructor(appName: string, devConfigFolderPath: string, configFileName: string = 'config')
```

The `appName` parameter is a string with the name of the app being configured. This name will be used to create a folder structure to host the configuration file. So we recommend that this name has no spaces or special characters.

The `devConfigFolderPath` parameter is a string with an absolute path to the development data folder structure. This structure is a copy of the system folders that will be used during production. For more info, see <https://github.com/alandrade21/devTestFolders>.

The `configFileName` optional parameter is a string with the configuration file name to be used. This file will have the .json extension. If this parameter is omitted, the name `config.json` will be used to the configuration file. If an empty value is passed, the constructor throws an [InvalidParameterError](#invalidparametererror). If the file system detects any problem with this name, the constructor throws a `ConfigFileError`.

This constructor verifies which is the user's OS, and choses the config folder accordingly. If the environment is development (see [EnvironmentDetector](#environmentdetector)), the config folder is set to the value informed in the `devConfigFolderPath` parameter. If the environment is not development and the OS is windows, the config folder is set to the folder `.config` inside the app installation folder. If the environment is not development and the OS is not windows (i.e. linux like OS), the config folder is set to the folder `.config/<<appName>>/` inside the actual OS user's home folder.
